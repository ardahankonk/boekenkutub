<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Boeken Cloud</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .container { background: white; padding: 2rem; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.1); width: 100%; max-width: 750px; }
        .form-group { display: flex; gap: 10px; margin-bottom: 20px; background: #f8f9fa; padding: 15px; border-radius: 8px; flex-wrap: wrap; }
        input, select, button { padding: 10px; border-radius: 6px; border: 1px solid #ddd; }
        button { cursor: pointer; background: #007bff; color: white; border: none; font-weight: 600; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { text-align: left; padding: 12px; border-bottom: 2px solid #eee; cursor: pointer; user-select: none; color: #555; }
        th:hover { background-color: #f1f1f1; }
        td { padding: 12px; border-bottom: 1px solid #eee; }
        
        .qty-controls { display: flex; align-items: center; gap: 8px; }
        .qty-input { width: 50px; text-align: center; border: 1px solid #ccc; padding: 4px; }
        .btn-qty { width: 28px; height: 28px; background: #e9ecef; color: black; padding: 0; }
        #status-bar { font-size: 0.85rem; margin-bottom: 10px; color: #666; width: 100%; max-width: 750px; }
    </style>
</head>
<body>

<div class="container">
    <h1>ðŸ“– Boeken Kutubhana</h1>
    
    <div id="status-bar">Status: Verbinding maken...</div>

    <div class="form-group">
        <input type="text" id="bookTitle" placeholder="Titel van het boek">
        <select id="bookLang">
            <option value="" disabled selected>Kies een taal</option>
            <option value="Nederlands">Nederlands</option>
            <option value="Turks">Turks</option>
            <option value="Russisch">Russisch</option>
            <option value="Russisch Latin">Russisch Latin</option>
            <option value="Oezbeeks">Oezbeeks</option>
            <option value="Oezbeeks Latin">Oezbeeks Latin</option>
            <option value="Engels">Engels</option>
            <option value="Arabisch">Arabisch</option>
        </select>
        <button onclick="addBook()">Toevoegen</button>
    </div>

    <div style="text-align: right; margin-bottom: 10px;">
        <button onclick="exportToExcel()" style="background:#28a745;">ðŸ“Š Export naar Excel</button>
    </div>

    <table>
        <thead>
            <tr>
                <th onclick="setSort('title')">Titel <span id="sort-title"></span></th>
                <th onclick="setSort('lang')">Taal <span id="sort-lang"></span></th>
                <th onclick="setSort('quantity')">Aantal <span id="sort-quantity"></span></th>
                <th>Acties</th>
            </tr>
        </thead>
        <tbody id="bookList"></tbody>
    </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, addDoc, onSnapshot, doc, updateDoc, deleteDoc, query, orderBy } 
    from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // --- JOUW CONFIG ---
  const firebaseConfig = {

  apiKey: "AIzaSyAz5kty9h1K7X0-VpTFsYyXyxdIBAzFnWQ",

  authDomain: "boeken-kutub.firebaseapp.com",

  projectId: "boeken-kutub",

  storageBucket: "boeken-kutub.firebasestorage.app",

  messagingSenderId: "996771778008",

  appId: "1:996771778008:web:3dd890468196f4843176ad"

};

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  const booksCol = collection(db, "books");

  let currentBooks = [];
  let sortField = 'createdAt';
  let sortDirection = 'desc';

  // Sortering instellen
  window.setSort = (field) => {
    if (sortField === field) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
    } else {
        sortField = field;
        sortDirection = 'asc';
    }
    updateTableIcons();
    renderTable();
  };

  function updateTableIcons() {
    ['title', 'lang', 'quantity'].forEach(f => {
        document.getElementById('sort-' + f).innerText = '';
    });
    const icon = sortDirection === 'asc' ? ' â†‘' : ' â†“';
    if(document.getElementById('sort-' + sortField)) {
        document.getElementById('sort-' + sortField).innerText = icon;
    }
  }

  // Live luisteren naar Firebase
  onSnapshot(query(booksCol), (snapshot) => {
    currentBooks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
    document.getElementById('status-bar').innerText = `âœ… Verbonden: ${currentBooks.length} boeken`;
    renderTable();
  });

  function renderTable() {
    const list = document.getElementById('bookList');
    list.innerHTML = '';

    // Sorteren van de lokale kopie
    const sorted = [...currentBooks].sort((a, b) => {
        let valA = a[sortField];
        let valB = b[sortField];
        
        // Zorg dat getallen als getallen vergeleken worden
        if (sortField === 'quantity') {
            return sortDirection === 'asc' ? valA - valB : valB - valA;
        }
        
        // Tekst sorteren (Turks-vriendelijk)
        return sortDirection === 'asc' 
            ? String(valA).localeCompare(String(valB), 'tr') 
            : String(valB).localeCompare(String(valA), 'tr');
    });

    sorted.forEach((book) => {
      list.innerHTML += `
        <tr>
            <td><strong>${book.title}</strong></td>
            <td>${book.lang}</td>
            <td>
                <div class="qty-controls">
                    <button class="btn-qty" onclick="updateQty('${book.id}', ${book.quantity - 1})">-</button>
                    <input type="number" class="qty-input" value="${book.quantity}" onchange="updateQty('${book.id}', this.value)">
                    <button class="btn-qty" onclick="updateQty('${book.id}', ${book.quantity + 1})">+</button>
                </div>
            </td>
            <td><button onclick="deleteBook('${book.id}')" style="background:#dc3545; padding:5px 10px; font-size:12px;">Verwijder</button></td>
        </tr>`;
    });
  }

  window.addBook = async () => {
    const title = document.getElementById('bookTitle').value;
    const lang = document.getElementById('bookLang').value;
    if (title && lang) {
        await addDoc(booksCol, { title, lang, quantity: 0, createdAt: Date.now() });
        document.getElementById('bookTitle').value = '';
        document.getElementById('bookLang').selectedIndex = 0;
    }
  };

  window.updateQty = async (id, val) => {
    await updateDoc(doc(db, "books", id), { quantity: Math.max(0, parseInt(val) || 0) });
  };

  window.deleteBook = async (id) => {
    if(confirm("Verwijderen?")) await deleteDoc(doc(db, "books", id));
  };

  // EXPORT MET BOM VOOR TURKSE TEKENS
  window.exportToExcel = async () => {
    const BOM = "\uFEFF";
    let csv = "Titel;Taal;Aantal\n";
    currentBooks.forEach(b => { csv += `${b.title};${b.lang};${b.quantity}\n`; });
    const blob = new Blob([BOM + csv], { type: "text/csv;charset=utf-8;" });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "boekenvoorraad.csv";
    link.click();
  };
</script>

</body>
</html>
